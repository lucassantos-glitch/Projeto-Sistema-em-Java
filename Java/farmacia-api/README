
# FarmÃ¡cia API

## DescriÃ§Ã£o

API REST para gerenciamento de uma farmÃ¡cia, permitindo cadastro de medicamentos, categorias, clientes, vendas, movimentaÃ§Ã£o de estoque e alertas de validade/estoque.

## Tecnologias Utilizadas

- **Java 17**
- **Spring Boot 3.5.9**
- **Spring Data JPA**
- **Spring Security 6.5.7** com autenticaÃ§Ã£o JWT
- **PostgreSQL 18.1** (banco de dados)
- **Springdoc OpenAPI 2.8.0 (Swagger)**
- **JJWT 0.12.3** (JSON Web Token)
- **Lombok**
- **HikariCP** (connection pool)

## Como Executar o Projeto

1. **Clone o repositÃ³rio:**
   ```sh
   git clone <url-do-repositorio>
   ```

2. **Configure o banco de dados PostgreSQL:**
   - Crie o banco de dados e conceda permissÃµes:
     ```sql
     CREATE DATABASE farmacia;
     GRANT ALL PRIVILEGES ON DATABASE farmacia TO postgres;
     ```
   - Certifique-se de que o usuÃ¡rio `postgres` existe e a senha estÃ¡ correta no arquivo `application.properties`.
   - Exemplo de configuraÃ§Ã£o (`src/main/resources/application.properties`):
     ```properties
     spring.datasource.url=jdbc:postgresql://localhost:5432/farmacia
     spring.datasource.username=postgres
     spring.datasource.password=Iphone1998
     spring.datasource.driver-class-name=org.postgresql.Driver
     spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
     spring.jpa.hibernate.ddl-auto=update
     spring.jpa.show-sql=true
     springdoc.swagger-ui.path=/swagger-ui.html
     ```

3. **Execute a aplicaÃ§Ã£o:**
   - No Linux/macOS:
     ```sh
     ./mvnw spring-boot:run
     ```
   - No Windows:
     ```sh
     mvnw spring-boot:run
     ```

4. **Acesse a documentaÃ§Ã£o Swagger:**
   - [http://localhost:8080/swagger-ui.html]

5. **As tabelas serÃ£o criadas automaticamente** no banco PostgreSQL ao iniciar a aplicaÃ§Ã£o.

## AutenticaÃ§Ã£o JWT

A API utiliza **autenticaÃ§Ã£o JWT (JSON Web Token)** para proteger os endpoints.

### Como Autenticar

1. **FaÃ§a login para obter o token:**
   ```http
   POST /auth/login
   Content-Type: application/json

   {
     "username": "admin",
     "password": "admin"
   }
   ```

2. **Resposta com o token:**
   ```json
   {
     "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "type": "Bearer"
   }
   ```

3. **Use o token nas requisiÃ§Ãµes:**
   - No Swagger UI: Clique no botÃ£o **Authorize** ðŸ”’ e cole o token
   - Em requisiÃ§Ãµes HTTP: Adicione o header `Authorization: Bearer SEU_TOKEN`

### ConfiguraÃ§Ãµes do Token

- **Validade:** 10 horas
- **Algoritmo:** HMAC SHA256
- **Armazenamento:** O Swagger UI salva automaticamente no localStorage do navegador

### UsuÃ¡rio PadrÃ£o

- **UsuÃ¡rio:** `admin`
- **Senha:** `admin`

> **Nota:** O token Ã© zerado automaticamente ao recarregar a pÃ¡gina do Swagger.

## ValidaÃ§Ãµes de Campos

A API possui validaÃ§Ãµes com mensagens personalizadas:

### Medicamento
- **Nome:** ObrigatÃ³rio e Ãºnico
- **PreÃ§o:** Deve ser maior que zero

### Cliente
- **E-mail:** ObrigatÃ³rio e vÃ¡lido
- **CPF:** ObrigatÃ³rio e Ãºnico

## Exemplos de Endpoints

### AutenticaÃ§Ã£o
- Login: `POST /auth/login`

### Categorias
- Listar categorias: `GET /categorias`
- Criar categoria: `POST /categorias`
- Buscar categoria por ID: `GET /categorias/{id}`

### Medicamentos
- Listar medicamentos: `GET /medicamentos`
- Cadastrar medicamento: `POST /medicamentos`
- Buscar medicamento por ID: `GET /medicamentos/{id}`
- Atualizar medicamento: `PUT /medicamentos/{id}`
- Deletar medicamento: `DELETE /medicamentos/{id}`
- Alterar status: `PATCH /medicamentos/{id}/status`

### Clientes
- Listar clientes: `GET /clientes`
- Cadastrar cliente: `POST /clientes`
- Buscar cliente por ID: `GET /clientes/{id}`
- Atualizar cliente: `PUT /clientes/{id}`
- Deletar cliente: `DELETE /clientes/{id}`

### Vendas
- Registrar venda: `POST /vendas`
- Listar vendas: `GET /vendas`
- Buscar venda por ID: `GET /vendas/{id}`
- Listar vendas por cliente: `GET /vendas/cliente/{clienteId}`

### Alertas
- Listar medicamentos com estoque baixo: `GET /alertas/estoque-baixo`
- Listar medicamentos com validade prÃ³xima: `GET /alertas/validade-proxima`

### Estoque
- Adicionar ao estoque: `POST /estoque/adicionar`
- Remover do estoque: `POST /estoque/remover`
- HistÃ³rico de movimentaÃ§Ãµes: `GET /estoque/historico/{medicamentoId}`

> **Importante:** Todos os endpoints (exceto `/auth/login`) exigem autenticaÃ§Ã£o JWT via Bearer Token.

## ObservaÃ§Ãµes

- O banco de dados utilizado Ã© o **PostgreSQL 18.1**
- O projeto utiliza **Lombok**. Certifique-se de instalar o plugin do Lombok em sua IDE
- A autenticaÃ§Ã£o JWT substitui o HTTP Basic Auth para maior seguranÃ§a
- Tokens JWT expiram apÃ³s 10 horas de inatividade
- O Swagger UI customizado gerencia automaticamente o armazenamento do token
- Para rodar os testes automatizados, utilize:
  ```sh
  ./mvnw test
  ```

## Estrutura do Projeto

```
farmacia-api/
â”œâ”€â”€ src/main/java/com/farmacia/
â”‚   â”œâ”€â”€ config/          # ConfiguraÃ§Ãµes (Swagger, Estoque)
â”‚   â”œâ”€â”€ controller/      # Controllers REST
â”‚   â”œâ”€â”€ dto/             # Data Transfer Objects
â”‚   â”œâ”€â”€ exception/       # Tratamento de exceÃ§Ãµes
â”‚   â”œâ”€â”€ model/           # Entidades JPA
â”‚   â”œâ”€â”€ repository/      # RepositÃ³rios JPA
â”‚   â”œâ”€â”€ security/        # ConfiguraÃ§Ãµes de seguranÃ§a (JWT, SecurityConfig)
â”‚   â”œâ”€â”€ service/         # LÃ³gica de negÃ³cio
â”‚   â””â”€â”€ validation/      # ValidaÃ§Ãµes customizadas
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ application.properties
    â””â”€â”€ static/
        â””â”€â”€ swagger-ui.html  # Swagger UI customizado
```
